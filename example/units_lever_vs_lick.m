batchPlotList = {...
	'desmond10', 20180909, 1, 1;... % up
	'desmond10', 20180909, 2, 1;... % up
	'desmond10', 20180909, 4, 1;... % up
	'desmond10', 20180909, 5, 1;... % up
	'desmond10', 20180909, 6, 1;... % up
	'desmond10', 20180909, 9, 1;... % up
	'desmond10', 20180909, 10, 1;... % up
	'desmond10', 20180909, 14, 1;... % up
	'desmond10', 20180910, 2, 1;... % up
	'desmond10', 20180910, 5, 1;... % up
	'desmond10', 20180910, 6, 1;... % DA up
	'desmond10', 20180910, 9, 1;... % DA up
	'desmond10', 20180910, 10, 1;... % up
	'desmond10', 20180910, 14, 1;... % DA
	'desmond10', 20180911, 1, 1;... % up
	'desmond10', 20180911, 5, 1;... % up
	'desmond10', 20180911, 7, 1;... % up
	'desmond10', 20180911, 9, 1;... % up
	'desmond10', 20180911, 10, 1;... % up
	'desmond10', 20180911, 13, 1;... % up
	'desmond10', 20180912, 5, 1;... % up
	'desmond10', 20180912, 6, 1;... % up
	'desmond10', 20180912, 10, 1;... % up
	'desmond10', 20180913, 4, 1;... % up
	'desmond10', 20180913, 5, 1;... % DA
	'desmond10', 20180913, 9, 1;... % burst
	'desmond10', 20180913, 32, 1;... % off error trials
	'desmond10', 20180915, 1, 1;... % DA
	'desmond10', 20180915, 1, 2;... % DA
	'desmond10', 20180915, 5, 1;... % up
	'desmond10', 20180915, 5, 2;... % up
	'desmond10', 20180915, 9, 1;... % up
	'desmond10', 20180915, 10, 1;... % up
	'desmond10', 20180916, 2, 1;... % up
	'desmond10', 20180916, 5, 1;... % up
	'desmond10', 20180916, 9, 1;... % up
	'desmond10', 20180916, 13, 1;... % up
	'desmond10', 20180917, 2, 1;... % DA up
	'desmond10', 20180917, 5, 1;... % up
	'desmond10', 20180917, 9, 1;... % up
	'desmond10', 20180917, 13, 1;... % DA
	'desmond10', 20180918, 1, 1;... % up
	'desmond10', 20180918, 2, 1;... % DA up
	'desmond10', 20180918, 5, 1;... % up
	'desmond10', 20180918, 9, 1;... % up
	'desmond10', 20180918, 10, 1;... % up
	'desmond10', 20180919, 1, 1;... % press not lick
	'desmond10', 20180919, 2, 1;... % DA up
	'desmond10', 20180919, 5, 1;... % DA up
	'desmond10', 20180919, 8, 1;... % flat
	'desmond10', 20180919, 9, 1;... % up
	'desmond10', 20180919, 10, 1;... % DA
	'desmond10', 20180919, 13, 1;... % DA
	'desmond10', 20180920, 4, 1;... % DA reward
	'desmond10', 20180920, 5, 1;... % up
	'desmond10', 20180920, 13, 1;... % DA
	'desmond10', 20180920, 16, 1;... % DA
	'desmond10', 20180920, 19, 1;... % flat
	'desmond10', 20180920, 29, 1;... % flat
	'desmond10', 20180921, 2, 1;... % up
	'desmond10', 20180921, 5, 1;... % up
	'desmond10', 20180921, 30, 1;... % flat
	'desmond10', 20180922, 4, 1;... % DA
	'desmond10', 20180922, 5, 1;... % up
	'desmond10', 20180922, 18, 1;... % lick cell
	'desmond10', 20180922, 30, 1;... % flat
	'desmond10', 20180923, 2, 1;... % flat
	'desmond10', 20180923, 6, 1;... % flat
	'desmond10', 20180923, 8, 1;... % flat
	'desmond10', 20180923, 10, 1;... % up
	'desmond10', 20180923, 30, 1;... % flat
	'desmond10', 20180924, 19, 1;... % ?
	'desmond10', 20180924, 25, 1;... % DA
	'desmond10', 20180924, 29, 1;... % ?
	'desmond10', 20180924, 30, 1;... % flat
	'desmond10', 20180925, 7, 1;... % up
	'desmond10', 20180925, 8, 1;... % flat
	'desmond10', 20180925, 10, 1;... % DA
	'desmond10', 20180925, 10, 2;... % flat
	'desmond10', 20180925, 19, 2;... % ??
	'desmond10', 20180925, 20, 2;... % DA
	'desmond10', 20180925, 29, 2;... % ??
	'desmond10', 20181017, 4, 1;... % DA
	'desmond10', 20181018, 1, 1;... % down
	'desmond10', 20181018, 7, 1;... % DA
	'desmond10', 20181018, 8, 1;... % down
	'desmond10', 20181018, 8, 2;... % DA
	'desmond10', 20181019, 1, 1;... % flat
	'desmond10', 20181019, 1, 2;... % DA
	'desmond10', 20181019, 7, 1;... % DA
	'desmond10', 20181019, 9, 1;... % up
	'desmond10', 20181020, 1, 1;... % up
	'desmond10', 20181020, 7, 1;... % up
	'desmond10', 20181022, 1, 1;... % up
	'desmond10', 20181022, 1, 2;... % DA
	'desmond10', 20181022, 7, 2;... % up




	'desmond11', 20180909, 5, 1;... % down/up
	'desmond11', 20180910, 5, 1;... % up
	'desmond11', 20180910, 27, 1;... % up
	'desmond11', 20180910, 28, 1;... % up
	'desmond11', 20180911, 10, 1;... % up
	'desmond11', 20180911, 27, 1;... % DA
	'desmond11', 20180912, 4, 1;... % up
	'desmond11', 20180912, 5, 1;... % up
	'desmond11', 20180912, 28, 1;... % DA ?
	'desmond11', 20180913, 28, 1;... % servo?
	'desmond11', 20180914, 27, 1;... % DA
	'desmond11', 20180914, 29, 1;... % up
	'desmond11', 20180915, 31, 1;... % up
	'desmond11', 20180915, 31, 2;... % up
	'desmond11', 20180916, 4, 2;... % down
	'desmond11', 20180916, 20, 1;... % DA
	'desmond11', 20180916, 20, 2;... % up
	'desmond11', 20180916, 31, 1;... % up
	'desmond11', 20180917, 8, 1;... % down
	'desmond11', 20180917, 28, 1;... % down
	'desmond11', 20180918, 8, 1;... % down
	'desmond11', 20180919, 23, 1;... % up
	'desmond11', 20180919, 28, 1;... % up
	'desmond11', 20180919, 30, 1;... % up
	'desmond11', 20180920, 18, 1;... % up
	'desmond11', 20180921, 2, 1;... % lick not press
	'desmond11', 20180922, 2, 1;... % lick not press
	'desmond11', 20180922, 28, 1;... % DA
	'desmond11', 20180924, 2, 1;... % up
	'desmond11', 20180924, 17, 1;... % up
	'desmond11', 20180924, 28, 1;... % DA
	'desmond11', 20180925, 2, 1;... % up
	'desmond11', 20181022, 28, 1;... % down
	'desmond11', 20181023, 28, 1;... % down
	'desmond22', 20210617, 1, 1;... % off
	'desmond22', 20210617, 3, 1;... % on maybe
	'desmond22', 20210617, 3, 2;... % slow on
	'desmond22', 20210617, 5, 1;... % slow on
	'desmond22', 20210621, 3, 1;... % flat
	'desmond22', 20210624, 1, 1;... % flat
	'desmond22', 20210624, 2, 1;... % flat
	'desmond22', 20210624, 3, 1;... % fast off the on
	'desmond22', 20210624, 4, 1;... % flat
	'desmond22', 20210624, 5, 1;... % flat
	% 'desmond22', 20210624, 5, 2;... % DA, slow on
	'desmond22', 20210624, 6, 1;... % flat
	'desmond22', 20210624, 7, 1;... % flat
	% 'desmond22', 20210624, 7, 2;... % DA flat
	'desmond22', 20210624, 8, 1;... % flat
	'desmond22', 20210624, 9, 1;... % fast off slow on
	'desmond22', 20210624, 9, 2;... % flat
	% 'desmond22', 20210630, 1, 1;... % DA flat
	'desmond22', 20210630, 3, 1;... % flat
	'desmond22', 20210630, 4, 1;... % slow off
	'desmond22', 20210630, 5, 1;... % slow off
	'desmond22', 20210630, 5, 2;... % flat
	'desmond22', 20210630, 6, 1;... % slow off
	'desmond22', 20210630, 7, 1;... % flat
	'desmond22', 20210630, 8, 1;... % flat
	'desmond22', 20210630, 8, 2;... % slow off
	'desmond22', 20210630, 10, 1;... % slow off
	'desmond22', 20210702, 2, 1;... % flat
	'desmond22', 20210702, 2, 2;... % flat
	'desmond22', 20210702, 3, 1;... % flat
	'desmond22', 20210702, 4, 1;... % flat
	'desmond22', 20210702, 5, 1;... % flat
	'desmond22', 20210702, 6, 2;... % slow up
	'desmond22', 20210702, 8, 1;... % flat
	'desmond22', 20210702, 9, 1;... % flat
	'desmond22', 20210702, 10, 2;... % slow up
	'desmond22', 20210702, 11, 1;... % flat
	'desmond22', 20210706, 1, 1;... % flat
	'desmond22', 20210706, 2, 1;... % flat
	'desmond22', 20210706, 3, 2;... % flat
	'desmond22', 20210706, 4, 1;... % flat
	'desmond22', 20210706, 5, 1;... % flat
	'desmond22', 20210706, 6, 1;... % flat
	'desmond22', 20210706, 7, 1;... % flat
	'desmond22', 20210706, 11, 2;... % fast off and slow on
	'desmond22', 20210707, 1, 1;... % flat
	'desmond22', 20210707, 1, 2;... % Slow on 
	'desmond22', 20210707, 2, 1;... % flat
	'desmond22', 20210707, 3, 1;... % off and slow on
	'desmond22', 20210707, 4, 1;... % flat
	'desmond22', 20210707, 5, 1;... % flat
	'desmond22', 20210707, 9, 1;... % flat
	'desmond22', 20210707, 12, 1;... % flat
	% 'desmond22', 20210707, 12, 1;... % DA slow on
	'desmond22', 20210707, 12, 2;... % flat
	'desmond22', 20210707, 14, 1;... % flat
	'desmond22', 20210707, 15, 1;... % flat
	'desmond22', 20210709, 4, 1;... % slow on
	'desmond22', 20210709, 4, 2;... % flat
	'desmond22', 20210709, 5, 1;... % flat
	'desmond22', 20210709, 6, 1;... % flat
	'desmond22', 20210709, 8, 1;... % slow up
	'desmond22', 20210709, 8, 2;... % slow up
	'desmond22', 20210709, 9, 1;... % flat
	'desmond22', 20210709, 12, 1;... % flat
	'desmond22', 20210709, 18, 1;... % flat
	'desmond22', 20210709, 21, 1;... % flat
	'desmond22', 20210709, 21, 2;... % flat


	'daisy8', 20210617, 2, 1;... % Up, stim flat maybe?
	'daisy8', 20210617, 2, 2;... % Up, stim flat maybe?
	'daisy8', 20210617, 3, 1;... % Up, stim flat maybe?
	'daisy8', 20210617, 4, 1;... % Up, stim up 50ms delay
	'daisy8', 20210617, 5, 1;... % Down, stim slow down maybe?
	'daisy8', 20210617, 7, 1;... % Up then down, stim slow up
	'daisy8', 20210617, 8, 1;... % Up, stim slow up
	'daisy8', 20210617, 10, 1;... % Up, stim slow up
	'daisy8', 20210617, 10, 2;... % Up, stim flat
	'daisy8', 20210617, 12, 1;... % Up, stim flat
	'daisy8', 20210617, 13, 1;... % Up, stim slow up
	'daisy8', 20210617, 14, 1;... % Up then down, stim slow up
	'daisy8', 20210618, 2, 1;... % Flat, stim flat
	'daisy8', 20210618, 3, 1;... % Up, stim flat
	'daisy8', 20210618, 6, 1;... % Up, stim slow up
	'daisy8', 20210623, 1, 1;... %
	'daisy8', 20210623, 2, 1;... % TODO Maybe Disentangle with next unit
	'daisy8', 20210623, 2, 2;... % TODO Maybe Disentangle with prev unit
	'daisy8', 20210623, 3, 1;... % TODO Maybe Disentangle with next unit
	'daisy8', 20210623, 3, 2;... % TODO Maybe Disentangle with prev unit
	'daisy8', 20210623, 4, 1;... %
	% 'daisy8', 20210623, 4, 2;... % DA
	'daisy8', 20210623, 5, 1;... %
	'daisy8', 20210623, 5, 2;... %
	'daisy8', 20210623, 6, 1;... %
	% 'daisy8', 20210625, 1, 1;... % DA inhibited by ChR2
	'daisy8', 20210625, 2, 1;... % Fast excitation
	'daisy8', 20210625, 4, 1;... % SNr opto off
	'daisy8', 20210625, 5, 1;... % SNr fast on
	'daisy8', 20210625, 7, 1;... % 
	'daisy8', 20210625, 8, 1;... % flat
	'daisy8', 20210630, 1, 1;... % slow on
	'daisy8', 20210630, 2, 1;... % fast off and then on at opto offset
	'daisy8', 20210630, 3, 1;... % slow off, lick cell?
	'daisy8', 20210630, 4, 1;... % slow on
	'daisy8', 20210630, 5, 1;... % slow on
	'daisy8', 20210630, 6, 1;... % slow on
	'daisy8', 20210702, 1, 1;... % flat
	'daisy8', 20210702, 1, 2;... % slow on
	'daisy8', 20210702, 2, 1;... % FAST on
	'daisy8', 20210702, 5, 1;... % flat
	'daisy8', 20210702, 7, 1;... % slow on
	'daisy8', 20210702, 8, 1;... % fast off slow on
	'daisy8', 20210702, 8, 2;... % fast off 25ms on
	'daisy8', 20210702, 9, 1;... % flat
	'daisy8', 20210702, 12, 1;... % slow off?
	'daisy8', 20210702, 13, 1;... % slow off?
	'daisy8', 20210702, 16, 1;... % flat
	'daisy8', 20210702, 16, 2;... % flat
	'daisy8', 20210702, 17, 1;... % fast on
	'daisy8', 20210702, 18, 1;... % flat
	'daisy8', 20210702, 18, 2;... % flat
	'daisy8', 20210706, 1, 1;... % on
	'daisy8', 20210706, 2, 1;... % fast on
	'daisy8', 20210706, 3, 1;... % fast on
	'daisy8', 20210706, 5, 1;... % slow on
	'daisy8', 20210706, 6, 1;... % flat
	'daisy8', 20210706, 7, 1;... % slow on
	'daisy8', 20210706, 9, 1;... % slow on
	'daisy8', 20210706, 11, 1;... % fast off
	'daisy8', 20210706, 12, 1;... % flat
	'daisy8', 20210706, 13, 1;... % fast on
	'daisy8', 20210706, 14, 1;... % fast on
	'daisy8', 20210706, 14, 2;... % flat
	'daisy8', 20210706, 15, 1;... % flat
	'daisy8', 20210706, 15, 2;... % flat
	'daisy8', 20210707, 1, 1;... % flat
	'daisy8', 20210707, 1, 2;... % flat
	'daisy8', 20210707, 2, 1;... % fast on
	'daisy8', 20210707, 3, 1;... % flat
	'daisy8', 20210707, 4, 1;... % flat
	'daisy8', 20210707, 4, 2;... % flat
	'daisy8', 20210707, 5, 1;... % flat
	'daisy8', 20210707, 7, 1;... % flat
	% 'daisy8', 20210707, 9, 1;... % DA slow off
	'daisy8', 20210707, 11, 1;... % flat
	'daisy8', 20210707, 12, 1;... % flat
	'daisy8', 20210707, 13, 1;... % flat
	'daisy8', 20210708, 1, 1;... % flat
	'daisy8', 20210708, 4, 1;... % on
	'daisy8', 20210708, 6, 1;... % fast on
	'daisy8', 20210708, 7, 1;... % slow off?
	'daisy8', 20210708, 8, 1;... % flat
	'daisy8', 20210708, 8, 2;... % slow on
	'daisy8', 20210708, 9, 1;... % slow on
	'daisy8', 20210708, 10, 1;... % flat
	'daisy8', 20210708, 11, 1;... % slow on
	'daisy8', 20210708, 11, 2;... % slow on
	'daisy8', 20210708, 13, 1;... % flat
	'daisy8', 20210708, 15, 1;... % fast off
	'daisy8', 20210708, 16, 1;... % flat
	'daisy8', 20210708, 17, 1;... % slow on
	'daisy8', 20210708, 18, 1;... % flat
	'daisy8', 20210708, 19, 1;... % flat
	'daisy8', 20210708, 19, 2;... % flat
	'daisy8', 20210708, 21, 1;... % slow on
	'daisy8', 20210709, 3, 1;... % fast off, slow on then, then slow off then slow on
	'daisy8', 20210709, 6, 1;... % fast on
	'daisy8', 20210709, 6, 2;... % flat
	'daisy8', 20210709, 7, 1;... % flat
	'daisy8', 20210709, 9, 1;... % flat
	'daisy8', 20210709, 10, 1;... % slow on
	% 'daisy8', 20210709, 12, 1;... % DA fast off
	'daisy8', 20210709, 16, 1;... % flat
	'daisy8', 20210709, 17, 1;... % slow on
	};



expNames = cell(length(batchPlotList), 1);
for iExp = 1:length(batchPlotList)
	expNames{iExp} = [batchPlotList{iExp, 1}, '_', num2str(batchPlotList{iExp, 2})];
end

expNamesUnique = unique(expNames);

% Make PETH struct
for iTr = 11:length(expNamesUnique)
	tr = TetrodeRecording.BatchLoad(expNamesUnique(iTr));
    if contains(expNamesUnique(iTr), 'desmond22')
        tr.ReadDigitalEvents();
    end
	try
		if iTr == 1;
			PETH = TetrodeRecording.BatchPETHistCounts(tr, batchPlotList, 'TrialLength', 6, 'ExtendedWindow', 1, 'SpikeRateWindow', 100, 'ExtendedWindowStim', [-1, 1], 'SpikeRateWindowStim', 10, 'Press', true, 'Lick', true, 'Stim', false);
		else
			PETH = [PETH, TetrodeRecording.BatchPETHistCounts(tr, batchPlotList, 'TrialLength', 6, 'ExtendedWindow', 1, 'SpikeRateWindow', 100, 'ExtendedWindowStim', [-1, 1], 'SpikeRateWindowStim', 10, 'Press', true, 'Lick', true, 'Stim', false)];
		end
	catch ME
		warning(['Error when processing iTr = ', num2str(iTr), ' - this one will be skipped.'])
		warning(sprintf('Error in program %s.\nTraceback (most recent at top):\n%s\nError Message:\n%s', mfilename, getcallstack(ME), ME.message))
	end
end


TetrodeRecording.HeatMap(PETH_PressVsLick, 'Normalization', 'zscore', 'Sorting', 'latency', 'MinNumTrials', 75, 'MinSpikeRate', 15, 'Window', [-4, 1], 'NormalizationBaselineWindow', [-4, -1], 'Lick', true, 'UseSameSorting', true);


